{% include "_modal2.html" %}
<div id="linkeddocuments3">
    <div class="col-12 mb-3">
    <h5>Linked uploadedfiles</h5>
        {% if publication.uploadedfiles|length >= 0 %}
          {% include "_uploadedfiles_table.html" %}
        {% else %}
          <p class="no-uploadedfiles">No uploadedfiles added yet.</p>
        {% endif %}
    </div>
  </div>
    <div id="searchdocumentpanel3" class="container">
      <div class="row">
       <div class="col"></div>
       <div class="col">
              <!-- Trigger the modal with a button -->
        <button type="button" class="btn btn-primary btn-danger" data-toggle="modal" data-target="#FileModal"><span class="fa fa-plus mr-2"></span>Create linked uploadedfile</button>

        <!-- Modal -->
        <div id="FileModal" class="modal fade" role="dialog">
          <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title col-md-10">Create Uploadedfile</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
              </div>
              <div class="modal-body">
                <div id="div_id_image_title" class="form-group">
                   <label for="id_image_title" class="">
                   Image title
                   </label>
                   <div class=""> <input type="text" name="image_title" maxlength="255" class="textinput textInput form-control" id="id_image_title"> </div>
                </div>
                <div class="form-group" >
                   <label for="id_filecategory" class="">
                   Filecategory
                   </label>
                   <div class="">
                      <div class="input-group">
                         <select name="filecategory" data-minimum-input-length="0" data-allow-clear="true" data-placeholder="---------" data-ajax--url="/select2/fields/auto.json" data-ajax--cache="true" data-ajax--type="GET" class="modelselect2widget form-control django-select2 django-select2-heavy" id="id_filecategory" data-field_id="Mjg3Njc2MjU0NzI1Ng:1lBbly:C5tObKpOSUQAtAsm1M3-zKzgD-o">
                            <option value=""></option>
                         </select>
                         <span class="input-group-append"><button  class="btn btn-danger" onClick="window.open(&#39;/filecategory/new&#39;, &#39;_blank&#39;, &#39;width=1000,height=600,menubar=no,toolbar=no&#39;);" type="button">+</button>
                         </span>
                      </div>
                   </div>
                </div>
                <div id="div_id_image_contents" class="form-group">
                   <label for="id_image_contents" class="">
                   Image contents
                   </label>
                   <div class=""> <select name="image_contents" data-minimum-input-length="0" data-allow-clear="true" data-placeholder="None" data-tags="true" data-token-separators="[&quot;;&quot;]" data-ajax--url="/select2/fields/auto.json" data-ajax--cache="true" data-ajax--type="GET" class="imagecontentselect2tagwidget form-control django-select2 django-select2-heavy" id="id_image_contents" data-field_id="Mjg3Njc2MjU0NzIwMA:1lBbly:Biz3kWZaMEUMhijwuP1zON6v7aI" multiple>
                      </select>
                   </div>
                </div>
                File
                <div id='my-drop-zone' class='needsclick'>
                   <div class="dz-message needsclick">
                      Drop file here or click to upload.
                   </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" id="create-file-btn" class="submit-btn btn btn-danger" data-dismiss="modal">Create</button>
              </div>
            </div>

          </div>
        </div>
        <br/>
        <br/>Search Files:<br/>
        <br/>
        <input type="text" id="id_search_files">
        </input>
        </div>
        <div class="col"></div>
    </div>
      <br/>
      <div class="col-12 mb-3">
      <h5>Uploadedfile candidates</h5>
        {% if uploadedfiles|length >= 0 %}
          {% include "_uploadedfiles_candidates_table.html" %}
        {% else %}
          <p class="no-uploadedfiles">No uploadedfiles added yet.</p>
        {% endif %}
      </div>
    </div>
<script type="text/javascript">
Dropzone.autoDiscover = false;
var myDropzone = new Dropzone("div#my-drop-zone", {
    url: "{% url 'uploadedfile-proces2' publication.pk %}",
    method: "post",
    autoProcessQueue: false,
    maxFiles: 1,
    addRemoveLinks: true,
    maxfilesexceeded: function(file) {
        this.removeAllFiles();
        this.addFile(file);
    },
    init: function () {
        var myDropzone = this;
        var addButton = $("#create-file-btn");
        addButton.click(function (e) {

        if (myDropzone.getQueuedFiles().length > 0) {

            e.preventDefault();
            myDropzone.processQueue();

        }
        });
    },
    sending: function (file, xhr, formData) {
        formData.append('csrfmiddlewaretoken', getCookie('csrftoken'));
        formData.append("image_title", $('#id_image_title').val());
        formData.append('filecategory', $('#id_filecategory').val());
        formData.append('image_contents', $('#id_image_contents').val());
    },
    success: function (file, response) {
        $("#uploadedfiles-div").html(response["table"]);
    }
});
function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
$("#my-drop-zone").addClass("dropzone");

</script>